# Exercise 1 - Circuit Breaker
In this excercise we will see how Hystrix helps in improving the robustness of distributed systems. We have created some JUnit tests (see: /microservices-breaking-up-a-monolith/src/exercise-circuitbreaker2/src/test/java) to show some of the functionality of Hystrix.  
These tests make use of the [Hystrix Examples] (https://github.com/Netflix/Hystrix/tree/master/hystrix-examples/src/main/java/com/netflix/hystrix/examples).

The tests cover most of the following use cases:

 - Remote system throws an Exception.
 - Call to remote system gives a timeout.
 - Too many requests are sent to remote system.
 - Too many exceptions occur in the remote system.
 - For some requests a cached response can be returned instead of calling the remote system.  
In all these cases Hystrix can provide fallback logic. 

1. Please go to `/microservices-breaking-up-a-monolith/src/exercise-circuitbreaker2/src/test/java/TimeOutTest.java`
This example uses a copy of the Hystrix Example HystrixCommandDemo to show how Hystrix responds to timeouts and exceptions in remote services.   
    Exercise: Run @Test and see the Hystrix response to timeouts and exceptions generated by `GetUserAccountCommand` and other commands. Also have a look at the Hystrix Demo code in GitHub.
    The log file should show that `GetUserAccountCommand` succesfully handles a timeout, but that CreditCardCommand does not.
    
2. Next look at `/microservices-breaking-up-a-monolith/src/exercise-circuitbreaker2/src/test/java/CacheTest`. This test is also based Hystrix Examples. This test shows the use of a request cache in Hystrix.
    Exercise: Run @Test and look at the code.
    
3. Go to `/microservices-breaking-up-a-monolith/src/exercise-circuitbreaker2/src/test/java/CollapserTest`. This test is also based Hystrix Examples. This test shows the use of batching functionality in Hystrix.
    Exercise: Run @Test and look at the code. 
    
4. Go to `/microservices-breaking-up-a-monolith/src/exercise-circuitbreaker2/src/test/java/TriggerCircuitOnFailuresTest`. This test uses `/microservices-breaking-up-a-monolith/src/exercise-circuitbreaker2/src/main/java/com/xebia/shop/circuitbreaker2/GetUserAccCommand.java`. This is a copy of `GetUserAccountCommand` in the Hystrix examples. 
    Exercise: Run @Test and see the CircuitBreaker being opened (SHORT_CIRCUITED) by FAILUREs in `GetUserAccCommand`, and closing again after a certain period.
    The behaviour is regulated by Hystrix property settings (see `TriggerCircuitOnFailuresTest`). for more information on the settings please refer to: [Configuration](https://github.com/Netflix/Hystrix/wiki/Configuration)
    Exercise: Change the errorThresholdPercentage and/or the failure percentage of `GetUserAccCommand`.   
    
5. Extra: For this exercise go to: /Users/marco/microservices-breaking-up-a-monolith/src/exercise-circuitbreaker/readme.md. 
     This exercise uses Hystrix to improve the robustness of the Shop. Please note that this version of the Ship still uses REST for communication between services.   


